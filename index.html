<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Color Picker with Custom Colors</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .toolbar {
            display: flex;
            align-items: center;
            background-color: #f1f3f4;
            padding: 5px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .color-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            position: relative;
        }
        .color-indicator {
            position: absolute;
            bottom: 0;
            left: 5px;
            right: 5px;
            height: 3px;
        }
        .color-picker {
            display: none;
            position: absolute;
            width: 232px;
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            margin-top: 270px;
        }
        .color-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            margin-bottom: 10px;
        }
        .color-cell {
            width: 20px;
            height: 20px;
            border: none;
            cursor: pointer;
            position: relative;
        }
        .color-cell.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-shadow: 0 0 2px black;
        }
        .custom-section {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .custom-label {
            margin-right: 10px;
            font-size: 14px;
        }
        .custom-button {
            width: 24px;
            height: 24px;
            background-color: white;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-right: 5px;
        }
        .custom-button i {
            font-size: 18px;
        }
        #editableDiv {
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 100px;
            margin-top: 10px;
        }
        #customColorPicker {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1001;
        }
        #colorGradient {
            width: 300px;
            height: 150px;
            background: linear-gradient(to right, #fff, #f00);
            margin-bottom: 10px;
            position: relative;
            cursor: crosshair;
        }
        #colorSlider {
            width: 300px;
            height: 20px;
            background: linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
            margin-bottom: 10px;
        }
        .color-preview {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            margin-right: 10px;
        }
        #customColorInputs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        #customColorInputs input {
            width: 60px;
        }
        #customColorButtons {
            display: flex;
            justify-content: flex-end;
        }
        #customColorButtons button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button class="color-button" onclick="toggleColorPicker()">
            <i class="material-icons">title</i>
            <div class="color-indicator" id="colorIndicator"></div>
        </button>
        
        <div class="color-picker" id="colorPicker">
            <div class="color-grid" id="colorGrid">
                <!-- Color cells will be dynamically added here -->
            </div>
            <div class="custom-section">
                <span class="custom-label">PERSONALIZADO</span>
                <button class="custom-button" onclick="openCustomColorPicker()">
                    <i class="material-icons">add</i>
                </button>
                <button class="custom-button" onclick="activateEyedropper()">
                    <i class="material-icons">colorize</i>
                </button>
            </div>
        </div>
    </div>

    <div id="editableDiv" contenteditable="true">
        Escribe o pega tu texto aquí. Selecciona el texto para aplicar colores.
    </div>

    <div id="customColorPicker">
        <div id="colorGradient">
            <div id="colorSelector" style="width: 10px; height: 10px; border-radius: 50%; border: 2px solid white; position: absolute; top: 0; left: 0;"></div>
        </div>
        <input type="range" id="colorSlider" min="0" max="360" value="0">
        <div id="customColorInputs">
            <div>
                <label for="hexInput">Hex:</label>
                <input type="text" id="hexInput" maxlength="7">
            </div>
            <div>
                <label for="rInput">R:</label>
                <input type="number" id="rInput" min="0" max="255">
            </div>
            <div>
                <label for="gInput">G:</label>
                <input type="number" id="gInput" min="0" max="255">
            </div>
            <div>
                <label for="bInput">B:</label>
                <input type="number" id="bInput" min="0" max="255">
            </div>
        </div>
        <div class="color-preview" id="colorPreview"></div>
        <div id="customColorButtons">
            <button onclick="cancelCustomColor()">Cancelar</button>
            <button onclick="acceptCustomColor()">Aceptar</button>
        </div>
    </div>

    <script>
        const colors = [
            ['#000000', '#434343', '#666666', '#999999', '#b7b7b7', '#cccccc', '#d9d9d9', '#efefef', '#f3f3f3', '#ffffff'],
            ['#980000', '#ff0000', '#ff9900', '#ffff00', '#00ff00', '#00ffff', '#4a86e8', '#0000ff', '#9900ff', '#ff00ff'],
            ['#e6b8af', '#f4cccc', '#fce5cd', '#fff2cc', '#d9ead3', '#d0e0e3', '#c9daf8', '#cfe2f3', '#d9d2e9', '#ead1dc'],
            ['#dd7e6b', '#ea9999', '#f9cb9c', '#ffe599', '#b6d7a8', '#a2c4c9', '#a4c2f4', '#9fc5e8', '#b4a7d6', '#d5a6bd'],
            ['#cc4125', '#e06666', '#f6b26b', '#ffd966', '#93c47d', '#76a5af', '#6d9eeb', '#6fa8dc', '#8e7cc3', '#c27ba0'],
            ['#a61c00', '#cc0000', '#e69138', '#f1c232', '#6aa84f', '#45818e', '#3c78d8', '#3d85c6', '#674ea7', '#a64d79'],
            ['#85200c', '#990000', '#b45f06', '#bf9000', '#38761d', '#134f5c', '#1155cc', '#0b5394', '#351c75', '#741b47'],
            ['#5b0f00', '#660000', '#783f04', '#7f6000', '#274e13', '#0c343d', '#1c4587', '#073763', '#20124d', '#4c1130']
        ];

        let selectedColor = '#000000';

        function createColorGrid() {
            const colorGrid = document.getElementById('colorGrid');
            colors.forEach(row => {
                row.forEach(color => {
                    const cell = document.createElement('button');
                    cell.className = 'color-cell';
                    cell.style.backgroundColor = color;
                    cell.onclick = () => selectColor(color);
                    colorGrid.appendChild(cell);
                });
            });
        }

        function selectColor(color) {
            selectedColor = color;
            updateColorIndicator();
            updateSelectedCell();
            applyColorToSelection(color);
            toggleColorPicker();
        }

        function updateColorIndicator() {
            document.getElementById('colorIndicator').style.backgroundColor = selectedColor;
        }

        function updateSelectedCell() {
            document.querySelectorAll('.color-cell').forEach(cell => {
                cell.classList.remove('selected');
                if (cell.style.backgroundColor === selectedColor) {
                    cell.classList.add('selected');
                }
            });
        }

        function toggleColorPicker() {
            const picker = document.getElementById('colorPicker');
            picker.style.display = picker.style.display === 'none' ? 'block' : 'none';
        }

        function applyColorToSelection(color) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.style.color = color;
                range.surroundContents(span);
            }
        }

        function openCustomColorPicker() {
            document.getElementById('customColorPicker').style.display = 'block';
            updateCustomColorPicker(selectedColor);
        }

        function updateCustomColorPicker(color) {
            const rgb = hexToRgb(color);
            document.getElementById('hexInput').value = color;
            document.getElementById('rInput').value = rgb.r;
            document.getElementById('gInput').value = rgb.g;
            document.getElementById('bInput').value = rgb.b;
            document.getElementById('colorPreview').style.backgroundColor = color;
            // Update gradient and slider
            // (This part would require more complex color conversion logic)
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function cancelCustomColor() {
            document.getElementById('customColorPicker').style.display = 'none';
        }

        function acceptCustomColor() {
            const hex = document.getElementById('hexInput').value;
            selectColor(hex);
            document.getElementById('customColorPicker').style.display = 'none';
        }

        function activateEyedropper() {
            if (!window.EyeDropper) {
                alert('Your browser does not support the EyeDropper API');
                return;
            }

            const eyeDropper = new EyeDropper();
            eyeDropper.open().then(result => {
                selectColor(result.sRGBHex);
            }).catch(e => {
                console.error(e);
            });
        }

        // Initialize the color grid and set the default color
        createColorGrid();
        updateColorIndicator();
        updateSelectedCell();

        // Add event listeners for custom color picker
        document.getElementById('colorGradient').addEventListener('click', function(e) {
            // Update color based on click position
            // (This would require more complex color calculation logic)
        });

        document.getElementById('colorSlider').addEventListener('input', function(e) {
            // Update gradient based on hue
            // (This would require more complex color calculation logic)
        });

        ['hexInput', 'rInput', 'gInput', 'bInput'].forEach(id => {
            document.getElementById(id).addEventListener('input', function(e) {
                // Update color preview and other inputs based on the changed input
                // (This would require more complex color conversion logic)
            });
        });
    </script>
</body>
</html>